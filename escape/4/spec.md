# 脱出ゲーム #4 仕様書（企画〜実装前）

## タイトル（仮）
雨音の記録室（#4）

## 概要
雨の夜だけ開く古い資料館の「記録室」で、引き出しに残された記録片を集めて整列し、最後に正しい時刻へ“進めて”脱出する。

- プレイ時間: 12〜18分（謎多め・テンポ重視）
- 難易度: Normal（ヒント3段階前提）
- ターゲット: スマホ/PC ブラウザ（縦画面優先）
- 技術: HTML/CSS/Vanilla JS（画像クリック型：背景＋ホットスポット）

## 体験の軸
- 現実っぽいのに、どこか一箇所だけ法則がズレている「静かで気持ち悪い」不思議感
- 小謎を短く連鎖させ、最後にメタ謎で一気に気持ちよく回収
- 主役は「引き出し（4×4）」＝探索と達成のリズムを担う

## 画面構成（4画面）
- 記録室（メイン）: 引き出し棚 / 机 / レコーダー / 時計 / 窓 / 配電盤 / 扉
- 廊下: コート掛け / 掲示板（符号表）/ 置き傘立て（雰囲気）
- 保管庫: 標本瓶 / 小箱 / 台帳破片 / テープ
- 洗面: 鏡 / 布 / 水滴の跡（雰囲気）

## 推奨決定（確認点1,2の結論）
- 引き出し棚は **4×4（16個）**で確定（記録片16枚＝メタ1が綺麗に完結）
- 最終時刻（メタ2）は **06:20** を推奨（「日付の月=時・日=分」を台帳で開示し、複数手がかりで納得感を作る）

---

## 主要オブジェクト
- 引き出し棚（4×4）: 記録片の主な入手元。いくつかは小ロック付き
- 卓上レコーダー: 雨音＋短長ビープ（符号表で数字化）
- 壁時計（00:00で停止）: 針は動かせる（“進める”）。座標・最終時刻に関与
- 窓（曇り）: 拭くと矢印列が出る（方向入力の核）
- 配電盤（簡易）: 差し替えで通電（スタンド解禁）
- 電気スタンド: 通電後、温度で出るインクを使う
- 台帳（書見台）: 規則の辞書。欠落ページを復元すると終盤キーが揃う

## インベントリ（想定）
- 布（washroom）
- 懐中電灯（hallway）
- 鏡（washroom：持ち運び可）
- 赤フィルム（storage：小箱）
- テープ（storage）
- プラグ（drawer）
- 台帳破片×3（drawers）
- 破れ紙片×2（drawer + hallway）
- 折り線入りの紙（drawer）
- 記録片×16（drawers中心 + 一部は周辺オブジェクトでも可）

---

## 記録片（メタ1用）
### 仕様
- 記録片は **16枚**。
- 各片に「1文字」と「分類スタンプ（記/録/雨/音）」と「連番（1〜4）」がある。
- 復元した台帳（後述）により、並べ順が明示される。

### 並べ順（台帳で明示するルール）
- 列順: **記 → 録 → 雨 → 音**
- 各列の並び: **1 → 2 → 3 → 4**

### 完成文（16文字）
「とけいをすすめ。あまおとをとめよ」

内訳:
- 記(1)と / 記(2)け / 記(3)い / 記(4)を
- 録(1)す / 録(2)す / 録(3)め / 録(4)。
- 雨(1)あ / 雨(2)ま / 雨(3)お / 雨(4)と
- 音(1)を / 音(2)と / 音(3)め / 音(4)よ

---

## 謎一覧（18＋メタ2）
### A 小謎（テンポ担当）
1. 窓の拭き取り（矢印列の出現：表示は「↗ ↘ ↙」、読むのは右から）
2. 引き出しラベル穴埋め（台帳索引参照）
3. 秤の軽重→2進変換（短コード）
4. 赤フィルタでのみ見える数字（隠し数字の取得）
5. マッチ箱メモ（「雨は右から読む」）
6. 破れ紙片の合成（次に見る引き出し誘導）
7. スタンプ日付（2020/06/??）
8. 瓶ラベル並べ替え（配電盤の色対応の根拠）

### B 中謎（部屋内ギミック）
9. レコーダー短長（符号表で数字化：**20** を得る）
10. 時計の針＝座標（特定引き出しを指す）
11. 反転文字（鏡で読む：小箱の番号 **319**）
12. 折り目暗号（開始引き出し番号の特定）
13. 温度で出るインク（貼り順・復元キー提示）
14. 配電盤の差し替え（プラグ接続＋差し替えで通電）

### C 大謎（章ボス）
15. 記録片の整列（メタ1成立＋ネガティブスペースで **3桁コード前半=814**）
16. 台帳の欠落ページ復元（方向入力の読み方＋メタ2の変換規則を解禁）
17. 方向入力（矢印列＋引き出し移動＋隠し数字で **後半=362**）
18. 出口ロック（6桁: **814362**、部分正解フィードバックあり）

### メタ
- メタ1: 15の整列で「文」が完成（“進める/止める”の意図がわかる）
- メタ2: 台帳の規則「月=時、日=分」により **06:20** に時計を合わせて脱出演出

---

## ヒント設計（3段階）
ヒントは「館内放送（スピーカー）」として提示。
- Lv1: どこを見るべきか
- Lv2: 何をどう変換するか
- Lv3: 入力直前（ほぼ答え）

---

## 画面ホットスポット設計（実装用）
### 記録室（record-room）
- 引き出し棚（drawers）: 4×4一覧UI → 個別引き出しモーダル
- 秤（scale）: 軽重の2択UI（3）
- 机（desk）: レコーダー再生 / 台帳閲覧 / 小物チェック
- レコーダー（recorder）: 再生ボタン（短/長の列をログへ）
- 時計（clock）: 針を動かすUI（時/分を指定 or ドラッグ）
- 窓（window）: 布使用で拭き取り→矢印列表示
- 配電盤（panel）: 配線差し替えUI（色/記号）
- 電気スタンド（lamp）: 通電後のみ点灯→熱インク対象を選べる
- 床（floor-grid）: 方向入力（17）の参照面（必要なら表示）※省略して引き出し移動に統合しても良い
- 扉（door）: 6桁入力UI（部分一致フィードバック）

### 廊下（hallway）
- コート掛け（coat）: 懐中電灯入手
- 掲示板（board）: 記録符号表（9用）/ 配電盤の断片ヒント
- 落とし物（lost-item）: 破れ紙片(1/2) など

### 保管庫（storage）
- 標本瓶（bottles）: 並べ替えUI（8）
- 小箱（small-case）: 鏡で反転数字を読んで開く（11: **319** → 赤フィルム）
- 台帳破片（ledger-scraps）: 取得（※一部は引き出し内）
- テープ（tape）: 取得（瓶謎の報酬 or 直置き）

### 洗面（washroom）
- 布（cloth）: 取得（1のキー）
- 鏡（mirror）: 取得（11のキー）
- 洗面台（sink）: 雰囲気（必要なら水滴で“右から読む”を補助）

---

## 引き出し棚（4×4）仕様
### 座標・番号
- 列: 1〜4（左→右）
- 段: 1〜4（上→下）
- 番号: 01〜16（上段左から横読み）
  - 01 02 03 04
  - 05 06 07 08
  - 09 10 11 12
  - 13 14 15 16

### 隠し数字（赤フィルムで見える）
方向入力（17）で読む「赤い数字」。この表は実装固定でOK。
- 01:7 02:1 03:8 04:4
- 05:0 06:9 07:5 08:3
- 09:6 10:3 11:7 12:2
- 13:8 14:1 15:6 16:4

※17で使う到着先（10→15→12）の赤数字が **3→6→2** になるようにしてある。

---

## 引き出し16個の「中身割り当て表」（実装用）
前提:
- すべての引き出しから「記録片」または「進行に必要なアイテム/破片」が出る。
- 記録片は基本的に引き出しから出す（テーマの一貫性）。

表記:
- ロック種別: `なし` / `文字` / `数字` / `条件` / `誘導`
- 主報酬: 記録片 or 重要アイテム
- 副報酬: メモ/破片/追加ヒント

| No | 座標(列,段) | ロック種別 | 解錠手がかり | 主報酬 | 副報酬 |
|---:|:-----------:|:----------:|:------------|:------|:------|
| 01 | (1,1) | なし | - | 記(1)「と」 | - |
| 02 | (2,1) | 文字 | 2（台帳索引で穴埋め） | 記(2)「け」 | 破れ紙片(2/2) |
| 03 | (3,1) | なし | - | 録(1)「す」 | スタンプ日付紙（7） |
| 04 | (4,1) | 数字 | 3（秤→短コード=**11**） | 録(2)「す」 | 折り線入りの紙（12） |
| 05 | (1,2) | なし | - | 記(3)「い」 | マッチ箱（5） |
| 06 | (2,2) | 誘導 | 6（破れ紙合成で“ここへ”） | 雨(1)「あ」 | - |
| 07 | (3,2) | 条件 | 赤フィルム所持（4/11） | 雨(2)「ま」 | プラグ |
| 08 | (4,2) | 数字 | 9（レコーダー→符号表：2桁=20） | 雨(3)「お」 | 台帳破片#1 |
| 09 | (1,3) | なし | - | 雨(4)「と」 | - |
| 10 | (2,3) | 誘導 | 10（時計座標 **02:30** で“ここ”を示す） | 音(1)「を」 | 台帳破片#2 |
| 11 | (3,3) | 文字 | 2（ラベル穴埋め別パターン） | 音(2)「と」 | 配電盤の色対応メモ（8の補強） |
| 12 | (4,3) | 条件 | 14（通電後に磁石ロック解除） | 音(3)「め」 | 熱インク用の紙（13の対象） |
| 13 | (1,4) | なし | - | 音(4)「よ」 | 台帳破片#3 |
| 14 | (2,4) | 数字 | 4（赤フィルムで見える3桁=**736**） | 記(4)「を」 | 赤数字の読み方メモ（16へ誘導） |
| 15 | (3,4) | 条件 | 12（折り目暗号で開始点提示） | 録(3)「め」 | 方向入力（17）の開始は「07」だと示すメモ |
| 16 | (4,4) | 条件 | 13（熱インクで“貼る順”） | 録(4)「。」 | 復元の貼り順最終ヒント |

補足:
- 「条件」ロックは、UI的には「引っかかって開かない」→該当フラグで開く想定。
- 07は“開始引き出し”として物語上重要なので、副報酬に「プラグ」を入れて中盤のブレイクスルーにする。

---

## 台帳復元（16）で解禁する決定的情報
### 方向入力（17）の読み方
- 窓で得た矢印列を「引き出し番号の上で」実行する
- **開始は07**（12で「15」を特定し、15のメモで「開始=07」を知る）
- 矢印は「到着先」の引き出し番号へ移動し、**赤い数字**を読む
- 最初の3つの到着先の赤数字が、出口コード後半（362）

### メタ2（正しい時刻）
- スタンプ日付（7）: `2020/06/??`
- レコーダー（9）: 解読結果が `20`（欠けた日）
- 台帳の規則: **月=時、日=分**
  - 2020/06/20 → **06:20**

---

## 出口ロック（18）部分正解フィードバック
- 0桁一致: 低いビープ（雨音そのまま）
- 1〜3桁一致: 雨音が一瞬だけ弱まる（ランプ1点灯）
- 4〜5桁一致: 秒針音が混ざる（ランプ2点灯）
- 6桁一致: 解錠演出（雨音が止み、時計音のみになる）

---

## アセット一覧（企画段階）
- 背景: record-room / hallway / storage / washroom（計4）
- UI: 引き出し一覧/個別モーダル、配電盤、時計合わせ、ロック入力
- 小物: レコーダー、マッチ箱、赤フィルム、台帳（破片）、テープ、鏡、布
- アイコン: スタンプ4種（記/録/雨/音）

## 受け入れ条件（企画→実装）
- 12〜18分程度でクリアできる導線（詰まりにくい）
- 16枚の記録片が論理的に集まり、整列で文が完成する
- 出口ロックに部分正解フィードバックがあり理不尽感がない
- 最終時刻（06:20）が複数手がかりから納得できる

## 次の作業（実装フェーズ）
- 4画面の背景作成・ホットスポット座標定義
- 状態管理（フラグ/所持品/引き出し解錠状態）
- モーダルUI（引き出し/入力/配電盤/時計/台帳復元/クリア）
- ヒント3段階の文言作成（謎ごと）
